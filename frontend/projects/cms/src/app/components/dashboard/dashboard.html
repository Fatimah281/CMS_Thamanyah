<div class="dashboard-container">
  <mat-toolbar color="primary" class="dashboard-header">
    <span class="header-title">
      <mat-icon>admin_panel_settings</mat-icon>
      CMS Thamanyah
    </span>
    <span class="spacer"></span>
    
    <div class="user-section" *ngIf="user$ | async as user">
      <div class="user-info">
        <span class="user-name">{{ user.displayName || user.email }}</span>
        <span class="user-email" *ngIf="user.email && user.displayName">{{ user.email }}</span>
      </div>
      <button mat-icon-button [matMenuTriggerFor]="userMenu" class="user-avatar">
        <mat-icon *ngIf="!user.photoURL">account_circle</mat-icon>
        <img *ngIf="user.photoURL" [src]="user.photoURL" [alt]="user.displayName" class="user-photo">
      </button>
      <mat-menu #userMenu="matMenu">
        <div class="user-menu-header" *ngIf="user">
          <div class="user-menu-info">
            <span class="user-menu-name">{{ user.displayName || 'User' }}</span>
            <span class="user-menu-email">{{ user.email }}</span>
          </div>
        </div>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="signOut()">
          <mat-icon>logout</mat-icon>
          <span>Sign Out</span>
        </button>
      </mat-menu>
    </div>
  </mat-toolbar>

  <div class="dashboard-content">
    <div class="content-header">
      <div class="header-info">
        <h1>Program Management</h1>
        <p>Manage your content, programs, and media files</p>
      </div>
      <div class="header-actions">
        <button mat-raised-button color="primary" (click)="addProgram()">
          <mat-icon>add</mat-icon>
          Add Program
        </button>
      </div>
    </div>

    <div class="loading-container" *ngIf="loading">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading programs...</p>
    </div>

    <div class="error-container" *ngIf="error">
      <mat-icon color="warn">error</mat-icon>
      <h3>Error loading programs</h3>
      <p>Please try again later</p>
      <button mat-raised-button color="primary" (click)="ngOnInit()">
        <mat-icon>refresh</mat-icon>
        Retry
      </button>
    </div>

    <div class="programs-grid" *ngIf="!loading && !error && (programs$ | async) as programs">
      <mat-card class="program-card" *ngFor="let program of programs">
        <div class="thumbnail-container" *ngIf="program.youtubeThumbnail">
          <img [src]="program.youtubeThumbnail" [alt]="program.title" class="program-thumbnail">
          <div class="thumbnail-overlay">
            <button mat-icon-button color="white" (click)="playVideo(program)" matTooltip="Play Video">
              <mat-icon>play_arrow</mat-icon>
            </button>
          </div>
          <div class="duration-badge" *ngIf="program.duration">
            {{ formatDuration(program.duration) }}
          </div>
        </div>
        
        <mat-card-content>
          <div class="program-header">
            <h3 class="program-title">{{ program.title }}</h3>
            <div class="program-meta">
              <mat-chip color="primary">{{ program.category?.name || program.categoryId }}</mat-chip>
              <mat-chip color="accent">{{ program.language?.name || program.languageId }}</mat-chip>
              <mat-chip *ngIf="program.videoType" color="warn">{{ program.videoType }}</mat-chip>
            </div>
          </div>
          
          <p class="program-description">{{ program.description | slice:0:150 }}{{ program.description.length > 150 ? '...' : '' }}</p>
          
          <div class="program-stats" *ngIf="program.viewCount || program.likeCount">
            <span class="stat" *ngIf="program.viewCount">
              <mat-icon>visibility</mat-icon>
              {{ program.viewCount | number }}
            </span>
            <span class="stat" *ngIf="program.likeCount">
              <mat-icon>thumb_up</mat-icon>
              {{ program.likeCount | number }}
            </span>
          </div>
          
          <div class="program-tags" *ngIf="program.tags && program.tags.length > 0">
            <mat-chip *ngFor="let tag of program.tags.slice(0, 3)" size="small">{{ tag }}</mat-chip>
          </div>
          
          <div class="program-date">
            <mat-icon>schedule</mat-icon>
            {{ formatDate(program.publishDate) }}
          </div>
        </mat-card-content>
        
        <mat-card-actions>
          <button mat-button color="primary" (click)="viewProgram(program)">
            <mat-icon>visibility</mat-icon>
            View
          </button>
          <button mat-button color="accent" (click)="editProgram(program)">
            <mat-icon>edit</mat-icon>
            Edit
          </button>
          <button mat-button color="warn" (click)="deleteProgram(program)">
            <mat-icon>delete</mat-icon>
            Delete
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <div class="empty-state" *ngIf="!loading && !error && (programs$ | async)?.length === 0">
      <mat-icon>video_library</mat-icon>
      <h3>No programs yet</h3>
      <p>Get started by adding your first program or syncing from YouTube</p>
      <div class="empty-state-actions">
        <button mat-raised-button color="primary" (click)="addProgram()">
          <mat-icon>add</mat-icon>
          Add Program
        </button>
      </div>
    </div>
  </div>
</div>
